# Case-study оптимизации

## Актуальная проблема
В нашем проекте возникла серьёзная проблема.

Необходимо было обработать файл с данными, чуть больше ста мегабайт.

У нас уже была программа на `ruby`, которая умела делать нужную обработку.

Она успешно работала на файлах размером пару мегабайт, но для большого файла она работала слишком долго, и не было понятно, закончит ли она вообще работу за какое-то разумное время.

Я решил исправить эту проблему, оптимизировав эту программу.

## Формирование метрики

Основная метрика - время отбработки файла.

Размер исходного файла 3 250 940 строк. 

Так как выполнение текущей реализация занимает слишком много времени, была проведена оценка времени выполнения.

Finish 100 lines in 0.001

Finish 1000 lines in 0.028

Finish 10000 lines in 1.767

Finish 20000 lines in 10.839

Уже на 50 000 текущая реализация занимает слишком много времени.

В качестве начальной метрики была взято время обработки 20 000 записей.

## Гарантия корректности работы оптимизированной программы
Программа поставлялась с тестом. Выполнение этого теста в фидбек-лупе позволяет не допустить изменения логики программы при оптимизации.

## Feedback-Loop
Для того, чтобы иметь возможность быстро проверять гипотезы я выстроил эффективный `feedback-loop`, который позволил мне получать обратную связь по эффективности сделанных изменений за 20 секунд

За это время выполнялся замер скорости для 20 000 строк и анализ кореектности работы на тестовых данных


Для того, чтобы найти "точки роста" для оптимизации я воспользовался ruby-prof c 

Вот какие проблемы удалось найти и решить

### Находка №1
- отчет graph показал что больше всего времени выполняется метод Array#select
- я нашел что он вызывается по каждому пользователя для всего массива сессий и предварительно сгруппировал сессиипо пользователю  
- метрика уменьшилась примерно 13 раз
- исправленная проблема перестала быть главной точкой роста

### Ваша находка №2
- какой отчёт показал главную точку роста
- как вы решили её оптимизировать
- как изменилась метрика
- как изменился отчёт профилировщика - исправленная проблема перестала быть главной точкой роста?

### Ваша находка №X
- какой отчёт показал главную точку роста
- как вы решили её оптимизировать
- как изменилась метрика
- как изменился отчёт профилировщика - исправленная проблема перестала быть главной точкой роста?

## Результаты
В результате проделанной оптимизации наконец удалось обработать файл с данными.
Удалось улучшить метрику системы с *того, что у вас было в начале, до того, что получилось в конце* и уложиться в заданный бюджет.

*Какими ещё результами можете поделиться*

## Защита от регрессии производительности
Для защиты от потери достигнутого прогресса при дальнейших изменениях программы *о performance-тестах, которые вы написали*

